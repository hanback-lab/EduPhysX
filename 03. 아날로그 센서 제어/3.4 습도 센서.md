# 습도 센서
## 습도
습도란 공기 중에 포함된 수증기의 양을 나타내는 물리량으로, 일반적으로 **상대습도(RH: Relative Humidity)** 를 사용합니다. 상대습도는 같은 온도에서 공기가 최대로 머금을 수 있는 수증기량에 대한 실제 수증기량의 비율(%)로 정의됩니다. 예를 들어 25℃에서 공기가 수증기를 최대로 20g까지 머금을 수 있는데, 실제로 10g의 수증기가 포함되어 있다면 상대습도는 50%가 됩니다.

습도는 인간의 생활과 산업 환경에 큰 영향을 미칩니다.

- 생활환경: 습도가 너무 낮으면 피부 건조, 호흡기 질환을 유발할 수 있고, 습도가 너무 높으면 곰팡이나 세균 번식의 원인이 됩니다.
- 산업환경: 반도체, 제약, 식품 저장 및 제조 과정에서는 일정한 습도 유지가 품질 관리에 매우 중요합니다.
- 건축환경: 실내 습도 관리가 적절하지 않으면 결로나 곰팡이가 발생하여 구조물의 수명과 건강에 악영향을 줍니다.

사람은 습도를 직접 감지하기 어렵기 때문에, 전기적 신호로 변환해 주는 센서가 필요합니다.
습도 센서는 공기 중의 수분량을 감지하여 전압, 전류, 저항, 정전용량 변화 등으로 변환하고, 이를 측정 장치가 읽어 상대습도 값으로 표시합니다. 이를 통해 공기 중 습도를 실시간으로 모니터링하고, 환기·가습·제습 장치 제어에 활용할 수 있습니다.

HIH-4030은 비율형(ratiometric) 아날로그 출력 습도 센서입니다.
출력 전압 (Vout) 은 공급 전압 (Vs) 와 상대습도(RH)에 비례하며, Arduino와 같은 MCU의 ADC 기준 전압(Vref) 을 공급 전압과 동일하게 둘 경우 공급 전압 변동의 영향을 받지 않습니다. 

- RH = (Vout / Vs - 0.16) / 0.0062

<img src="res/Humidity Schematic.png" style="width:60%;">

## 습도 센서 연결 
습도센서 하드웨어 연결은 다음과 같습니다. 

| Pin | 연결 대상 | 설명 |
|:---:|:---:|:---|
| 5V | +5V | 전원 |
| GND | GND | 접지 |
| A3 | A | Humidity Sensor |
 
## 습도 감지 프로그램 

```cpp
int pin_humi = A3;

void setup() {
    Serial.begin(115200);
    pinMode(pin_humi, INPUT);
}

void loop() {
    Serial.print("ADC Data :");
    Serial.println(analogRead(pin_humi));
    delay(500);
}
```

다음은 HIH-4030의 특성을 반영한 코드입니다. ADC 평균 샘플링, 전압 변환, 상대습도 계산, 그리고 0~100% 범위 제한을 포함합니다.
```cpp
const int pin_humi = A3;
const float vsup = 5.0;
const float adc_max = 1023.0;
const float vref = 5.0;

int readADCavg(int n=16) {
    long s=0; 
    for (int i=0;i<n;i++){ 
        s += analogRead(pin_humi); 
        delay(2); 
    }
    return (int)(s/n);
}

void setup(){
    Serial.begin(115200);
}

void loop(){
    int adc = readADCavg();
    float vout = (adc / adc_max) * vref;
    float sensorRH = (vout / vsup - 0.16f) / 0.0062f;

    if (sensorRH < 0) 
        sensorRH = 0;
    if (sensorRH > 100) 
        sensorRH = 100;

    Serial.print("ADC="); Serial.print(adc);
    Serial.print("\tVout="); Serial.print(vout,3);
    Serial.print(" V\tRH~"); Serial.print(sensorRH,1);
    Serial.println(" %");
    delay(250);
}
```