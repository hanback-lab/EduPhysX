# LED 제어 
## LED 
LED는 Light-emitting diode의 약자로서, 발광다이오드라 부릅니다. 이는 빛을 발산하는 반도체 소자를 말하며, 방출하는 빛의 색깔은 크리스털 도핑(Crystal Doping)의 양과 종류에 따라 적색, 녹색 또는 황색등이 될 수 있습니다. 일반 백열전구에 비하여 소비전력은 1/5밖에 안되고, 반응시간은 백만 배나 빠르며, 수명은 반영구적으로 향상되어 정밀 반도체 장비 검사기, 자동차 계기판 등의 전자 표시판, 전광판, 산업기기 표시기 및 각종 교통안전 신호기 등등에 많이 사용됩니다.

![LED](res/LED.png)

LED 회로는 다음과 같습니다. 

![LED Schematic](res/LED%20Schematic.png)

### LED 제어 회로 구성시 주의 사항 
LED는 정전류 소자로, 지나가는 전류가 많으면 손상될 수 있습니다. 따라서 반드시 직렬로 저항(보통 220Ω~1kΩ)을 연결하여 전류를 제한해야 합니다.

저항값은 옴의 법칙에 따라 다음과 같이 계산할 수 있습니다. 
- R = (Vcc- Vf) / I
    - Vcc : 입력 전압
    - Vf : 순방향 전압 
    - I : 전류 

예를 들어, 5V 전원에서 LED 의 순방향 전압(Vf) 가 2V이고, 전류(I)가 10mA 일때를 계산해보면 다음과 같습니다.
- R = (5-2)/0.01 = 300

이 경우에는 330Ω 의 저항을 사용하면 적절합니다. 

## LED 연결 
LED 하드웨어 연결은 다음과 같습니다. 

| Pin | 연결 대상 | 설명 |
|:---:|:---:|:---|
| GND | GND | 접지 |
| 4 | D0 | LED 0 |
| 5 | D1 | LED 1 |
| 6 | D2 | LED 2 |
| 7 | D3 | LED 3 |
| 8 | D4 | LED 4 |
| 9 | D5 | LED 5 |
| 10 | D6 | LED 6 |
| 11 | D7 | LED 7 |

## LED 제어 프로그램 
### 단일 LED 제어 
LED 제어 프로그램은 다음과 같습니다. 가장 먼저 작성하는 프로그램은 1개의 LED를 1초마다 켜고/끄는 형태입니다. 

```arduino
int pin_led = 4;

void setup() {
    pinMode(pin_led, OUTPUT);
}

void loop() {
    digitalWrite(pin_led, HIGH);
    delay(1000);
    digitalWrite(pin_led, LOW);
    delay(1000);
}
```

### 다중 LED 제어 
여러개의 LED를 제어할때는 다음과 같이 작성할 수 있습니다. 
```arduino
int pin_leds[8] = {4,5,6,7,8,9,10,11};
int i;

void setup() {
    for(i=0;i<8;i++){
        pinMode(pin_leds[i], OUTPUT);
    }
}

void loop() {
    for(i=0;i<8;i++){
        digitalWrite(pin_leds[i], HIGH);
        delay(200);
    }
    for(i=0;i<8;i++){
        digitalWrite(pin_leds[i], LOW);
        delay(200);
    }
}
```

### PWM을 통한 밝기 제어 
digitalWrite()를 통해 HIGH 혹은 LOW 로 제어하면 켜거나 끄는 제어는 가능하지만 세부적인 밝기제어는 할 수 없습니다. analogWrite() 를 통해 제어하게되면 PWM 방식으로 LED 밝기를 제어할 수 있습니다. 
```arduino
int pin_led = 4;

void setup() {
    pinMode(pin_led, OUTPUT);
}

void loop() {
  for(int i = 0; i<255; i++) {
    analogWrite(pin_led, i);
    delay(20);
  }
  for(int i = 255; i>=0; i--) {
    analogWrite(pin_led, i);
    delay(20);
  }
}
```

### 8비트 이진 패턴 출력 
이번 예제는 8개의 LED를 이용해 하나의 8비트 숫자를 시각적으로 표현합니다. 
`0`부터 `255`까지의 숫자를 1씩 증가시키며, 각 숫자의 이진 표현을 LED로 출력합니다.  

예를 들어, 숫자 `5`는 이진수로 `00000101` 이므로, 오른쪽에서 첫 번째와 세 번째 LED가 켜지게 됩니다.

각 비트는 `bitRead()` 함수를 이용하여 읽어옵니다. 이 함수는 주어진 정수의 특정 비트 위치에 있는 값을 반환하며, 해당 비트가 `1`이면 LED를 켜고, `0`이면 끄도록 제어합니다.
```arduino
int pin_leds[8] = {4,5,6,7,8,9,10,11};
int i = 0;
static uint8_t counter = 0;

void setup() {
  Serial.begin(115200);
    for(i=0; i<8; i++){
        pinMode(pin_leds[i], OUTPUT);
        digitalWrite(pin_leds[i], LOW);
    }
}

void showByte(uint8_t value) {
    for(i=8-1; i>=0; i--){
        int bitVal = bitRead(value, i);
        digitalWrite(pin_leds[i], bitVal ? HIGH : LOW);
    }
}

void loop() {   
    showByte(counter);
    Serial.println(counter);
    counter++;
    if(counter > 255)
      counter = 0;
    delay(150);
}
```