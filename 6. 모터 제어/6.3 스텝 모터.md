# 스텝 모터
## 스텝 모터
스텝 모터는 입력되는 펄스 신호에 따라 일정한 각도(스텝 각도)만큼 회전하는 모터입니다. 일반 DC 모터와 달리 연속적인 회전 속도 제어보다는 위치 제어와 정밀한 각도 제어에 적합합니다.

스텝 모터는 개폐기, 프린터, CNC, 로봇 암, 3D 프린터 등에서 널리 사용되며, 제어 신호의 개수와 순서에 따라 회전 각도와 방향이 결정됩니다.

### 스텝 모터 특징 
- 펄스 신호 입력 수에 비례하여 정확한 회전 각도를 얻을 수 있습니다.
- 개방 루프(open-loop) 방식에서도 정밀한 위치 제어가 가능합니다.
- 구조가 단순하고 내구성이 높습니다.
- 저속에서 높은 토크를 얻을 수 있습니다.
- 단점으로는 고속 회전 시 토크가 급격히 감소하며, 공진 현상(진동)이 발생할 수 있습니다.

### 스텝 모터 구조 및 제어 
스텝 모터는 크게 **스테이터(Stator)** 와 **로터(Rotor)** 로 구성됩니다.
- 스테이터(Stator) : 고정자 코일로, 입력 펄스 신호에 따라 자계가 형성됩니다.
- 로터(Rotor) : 자성체 또는 영구자석으로 이루어진 회전자이며, 스테이터의 자계 방향에 따라 회전합니다.
- 구동 회로 : 코일에 펄스를 인가하는 순서를 제어하여 모터의 회전 각도 및 방향을 제어합니다.

스텝 모터는 펄스 신호의 개수와 순서에 따라 회전이 이루어집니다.
- 스텝 각도(Step Angle) : 모터가 펄스 한 개 입력 시 회전하는 각도
    - 예: 스텝 각도가 1.8°인 경우, 200펄스 입력 시 360° 회전
- 구동 방식
    - 풀 스텝(Full Step) : 한 번에 한 상을 여자하여 큰 각도로 회전
    - 하프 스텝(Half Step) : 상을 교대로 여자하여 풀 스텝의 절반 각도로 회전
    - 마이크로 스텝(Micro Step) : 전류를 세밀하게 제어하여 매우 작은 각도로 회전 → 진동이 줄고 정밀 제어 가능

### 스텝모터 구동 방식 
스텝 모터는 코일(상, Phase)에 전류를 인가하는 방법에 따라 다음과 같은 구동 방식을 갖습니다.

| 구동 방식 | 여자(전류 인가) 형태 | 스텝 각도 | 토크 | 전류 소모 | 특징 |
| :--- | :--- | :--- | :--- | :--- | :--- | 
| 1상 구동 (Single Phase Excitation) | 한 번에 한 상만 여자 | 크다 (기본 스텝) | 작음 | 적음 | 전력 효율이 높지만 토크가 낮음 |
| 2상 구동 (Dual Phase Excitation) | 두 상을 동시에 여자 | 같음 (기본 스텝) | 큼 | 많음 | 토크가 크고 안정적이지만 소비 전류가 많음 |
| 1-2상 구동 (Half Step Excitation) | 1상 ↔ 2상 교대로 여자 | 절반(½ 스텝) | 중간 | 중간 | 정밀 제어 가능, 진동이 적고 부드럽게 회전 |

#### 1상 구동 (Single Phase Excitation)
한 번에 하나의 상만 여자되는 방식으로, 전력 소모가 적고 효율이 높지만 토크가 약합니다.
부하가 작은 위치 제어나 저속 구동에 적합합니다.

- A → B → /A → /B → (반복)

#### 2상 구동 (Dual Phase Excitation)
두 개의 상에 전류를 동시에 인가하는 방식으로, 1상 구동보다 토크가 약 1.4배 크며, 회전이 보다 안정적입니다. 단점은 전류 소모가 많고, 발열이 증가한다는 점입니다.

- AB → B /A → /A /B → /B A → (반복)

#### 1-2상 구동 (Half Step Excitation)
1상 구동과 2상 구동을 교대로 수행하는 하이브리드 방식으로, 1회 회전당 스텝 각도가 절반이 되어 정밀 제어가 가능하며, 회전이 부드럽고 진동이 감소합니다.

- A → AB → B → B /A → /A → /A /B → /B → /B A → (반복)

![Step Motor Schematic](res/StepMotor%20Schematic.png)

## 스텝 모터 연결 
| Pin | 연결 대상 | 설명 |
|:---:|:---:|:---|
| 12V | +12V | 전원 |
| GND | GND | 접지 |
| 8 | EN | Step Motor Enable |
| 9 | A | Step Motor A |
| 10 | B | Step Motor B |
| 11 | /A | Step Motor /A |
| 12 | /B | Step Motor /B |

## 1상 제어 
다음 예제는 1상제어 코드입니다. 각 핀의 출력을 LOW 로 설정하고 한개씩 HIGH 로 변경하며 제어합니다. 이전 상태가 HIGH 였던 핀은 LOW로 변경이 되어야 합니다. 

```cpp
const int PIN_EN=8;
const int PIN_A=9;
const int PIN_B=10;
const int PIN_2A=11;
const int PIN_2B=12;

void setup(){
  pinMode(PIN_EN,OUTPUT);
  digitalWrite(PIN_EN, HIGH);
  pinMode(PIN_A,OUTPUT);
  digitalWrite(PIN_A, LOW);
  pinMode(PIN_B, OUTPUT);
  digitalWrite(PIN_B, LOW);
  pinMode(PIN_2A,OUTPUT);
  digitalWrite(PIN_2A, LOW);
  pinMode(PIN_2B,OUTPUT);
  digitalWrite(PIN_2B, LOW);  
}

void loop(){
  digitalWrite(PIN_A,HIGH);
  digitalWrite(PIN_B,LOW);
  digitalWrite(PIN_2A,LOW);
  digitalWrite(PIN_2B,LOW);
  delay(50);
  digitalWrite(PIN_A,LOW);
  digitalWrite(PIN_B,HIGH);
  digitalWrite(PIN_2A,LOW);
  digitalWrite(PIN_2B,LOW);
  delay(50);
  digitalWrite(PIN_A,LOW);
  digitalWrite(PIN_B,LOW);
  digitalWrite(PIN_2A,HIGH);
  digitalWrite(PIN_2B,LOW);
  delay(50);
  digitalWrite(PIN_A,LOW);
  digitalWrite(PIN_B,LOW);
  digitalWrite(PIN_2A,LOW);
  digitalWrite(PIN_2B,HIGH);
  delay(50);
}
```

## 2상 제어 
이번에는 2상제어 코드입니다. 1상과 다르게 2상은 2개가 HIGH인상태를 유지하도록 구성해야합니다. 이때 역방향으로 돌리고 싶다면 제어 핀 순서를 아래 작성된 역순으로 실행하도록 변경하면됩니다.

```cpp
const int PIN_EN=8;
const int PIN_A=9;
const int PIN_B=10;
const int PIN_2A=11;
const int PIN_2B=12;

void setup(){
  pinMode(PIN_EN,OUTPUT);
  digitalWrite(PIN_EN, HIGH);
  pinMode(PIN_A,OUTPUT);
  digitalWrite(PIN_A, LOW);
  pinMode(PIN_B, OUTPUT);
  digitalWrite(PIN_B, LOW);
  pinMode(PIN_2A,OUTPUT);
  digitalWrite(PIN_2A, LOW);
  pinMode(PIN_2B,OUTPUT);
  digitalWrite(PIN_2B, LOW);  
}

void loop(){
  digitalWrite(PIN_A,HIGH);
  digitalWrite(PIN_B,HIGH);
  digitalWrite(PIN_2A,LOW);
  digitalWrite(PIN_2B,LOW);
  delay(10);
  digitalWrite(PIN_A,LOW);
  digitalWrite(PIN_B,HIGH);
  digitalWrite(PIN_2A,HIGH);
  digitalWrite(PIN_2B,LOW);
  delay(10);
  digitalWrite(PIN_A,LOW);
  digitalWrite(PIN_B,LOW);
  digitalWrite(PIN_2A,HIGH);
  digitalWrite(PIN_2B,HIGH);
  delay(10);
  digitalWrite(PIN_A,HIGH);
  digitalWrite(PIN_B,LOW);
  digitalWrite(PIN_2A,LOW);
  digitalWrite(PIN_2B,HIGH);
  delay(10);
}
```