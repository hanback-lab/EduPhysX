# 가스 센서
## 가스
가스는 생활환경 속에 다양하게 존재하며, 일반 가정이나 업소, 공사장에서는 가스 사고가, 산업 현장에서는 폭발 사고나 오염 공해의 위험으로 이어질 수 있습니다. 그러나 인간의 감각 기관인 후각만으로는 이러한 가스의 종류와 농도를 정확히 판별하기 어렵습니다.

가스 센서(Gas Sensor) 는 이와 같은 한계를 보완하는 소자로, 가스의 누설이나 농도를 측정하고 종류를 판별하여 위험 상황을 사전에 알려줍니다. 가장 밀접한 활용 예시는 가정이나 산업 현장에서 사용하는 가스 경보기와 환경 계측기입니다.

특히 실내 공기에는 담배 연기, 연료용 가스, 유기 용제 등 다양한 오염원이 존재합니다. 미국 환경보호국(EPA)에 따르면 실내 오염물질 농도는 실외보다 2~5배 높으며, 이는 장시간 실내에서 생활하는 현대인들에게 건강상의 문제를 야기합니다. 환기 부족이나 밀폐 건물에서는 농도가 더욱 높아져 빌딩 증후군(Sick Building Syndrome, SBS) 의 원인이 되기도 합니다.

가스 센서는 이와 같은 유해 가스를 일정 한계치 이하에서 감지할 수 있도록 개발되었습니다. 예를 들어 프로판가스(LPG) 센서는 폭발 하한계(LEL)가 2.2%인 연료 가스를 감지합니다. LPG 센서에는 여러 방식이 있으며, 대표적으로 반도체식, 접촉 연소식, 열전도식이 있습니다. 이 중 반도체식과 접촉 연소식이 가격과 성능 면에서 가장 널리 사용됩니다.

![Gas]()

![Gas Schematic](res/Gas%20Schematic.png)

여기에 사용된 MQ-5 센서는 대표적인 반도체식 가스 센서로, 내부에 SnO₂(산화주석) 반도체 소자를 사용하여 가스를 감지합니다. 이 센서는 수소, LPG, 메탄, 부탄 등의 연료성 가스에 민감하게 반응하며, 일정 농도 이상일 때 전도도가 변하여 전압이 변화합니다. 

## 가스 센서 작동 원리 
1. 히터 역할
  - 센서 내부의 히터는 반도체 소자의 표면 온도를 약 **200~300℃**로 일정하게 유지합니다.이 온도에서는 SnO₂ 표면에 공기 중의 산소 분자(O₂) 가 흡착되어 산소 이온(O⁻, O₂⁻) 으로 변하게 됩니다. 이때, 산소 이온이 반도체 표면에서 전자를 빼앗기 때문에 전자의 이동이 억제되어 저항이 커집니다.

2. 가스 유입 시 변화
  - 만약 주변에 LPG, 수소(H₂), 메탄(CH₄) 등의 환원성 가스가 존재하면, 이 가스들이 흡착된 산소 이온과 반응하여 전자(e⁻) 를 다시 방출하게 됩니다. 그 결과, 반도체 내부의 전자 밀도가 증가하고 전도도가 높아져 저항이 감소합니다.

3. 전압 변화 감지
  - 센서는 이 저항 변화(Rs) 를 로드 저항(RL)과 분압 회로 형태로 구성하여 출력 전압으로 변환합니다. 따라서, 가스 농도가 높을수록 저항은 낮아지고 출력 전압은 높아지는 특성을 가집니다.

## 가스 센서 연결 
가스 센서 하드웨어 연결은 다음과 같습니다. 
| Pin | 연결 대상 | 설명 |
|:---:|:---:|:---|
| 5V | +5V | 전원 |
| GND | GND | 접지 |
| A2 | A | Gas Sensor |

## 가스 감지 프로그램 
가스 센서 출력 전압을 ADC 값으로 읽어오는 기본 예제입니다. 값이 높을수록 공기 중 가스 농도가 높음을 의미합니다. 

```cpp
int pin_gas = A2;

void setup() {
    Serial.begin(115200);
    pinMode(pin_gas, INPUT);
}

void loop() {
    Serial.print("ADC Data :");
    Serial.println(analogRead(pin_gas));
    delay(100);
}
```

## PPM 변환 
센서의 아날로그 출력은 단순 전압이므로, 실제 가스 농도(ppm)로 변환하려면 센서의 비교 기준(R0) 과 보정 곡선을 적용해야 합니다.

아래 예제는 MQ-5의 데이터시트에서 제시된 경험적 상수를 기반으로 가스 농도를 계산한 코드입니다.

```cpp
int pin_gas = A2;
float vcc = 5.0;
float RL = 10000.0;
float R0 = 9000.0;
float A_coef = 574.25;
float B_coef = -2.222;

float readPPM() {
  int adc = analogRead(pin_gas);
  float v = (adc / 1023.0) * vcc;
  float Rs = RL * (vcc / v - 1.0);
  float ratio = Rs / R0;
  float ppm = A_coef * pow(ratio, B_coef);
  return ppm;
}

void setup() {
  Serial.begin(115200);
}

void loop() {
  float ppm = readPPM();
  Serial.print(ppm);
  Serial.println(" ppm");
  delay(500);
}
```

조금 더 정확한 데이터 측정을 위해서는 공기 중 기준 보정이 필요합니다. 기준 보정 방법은 다음 과 같습니다. 
1. 전원 인가 후 2~5분간 예열 합니다.
2. 공기중 측정된 Rs 값을 기준으로 "R0 = Rs / 9.8" 으로 설정합니다. 
3. 이후 측정 값에서 Rs/R0 비율을 계산하여 각 가스의 농도로 환산합니다. 
