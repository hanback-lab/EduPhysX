# 음성 인식
음성 인식(Speech Recognition)은 인간의 음성을 분석하여 컴퓨터가 이해할 수 있는 텍스트나 명령으로 변환하는 기술입니다.

스마트 스피커, 음성 비서, 차량용 음성 제어 시스템 등 다양한 장치에서 활용되며, 사람과 기계 간 상호작용을 더욱 자연스럽게 만들어줍니다.

특히 프로그래밍 환경에서는 마이크 입력을 기반으로 특정 단어를 인식하거나 장치를 직접 제어하는 등, 실습과 응용 범위가 매우 넓습니다.

## SpeechRecognition
SpeechRecognition 패키지는 STT(Speech To Text) 패키지들 중 가장 대표적인 라이브러리입니다. 이 패키지는 Host PC의 마이크 및 오디오 파일을 통해 음성 데이터를 확보한 후, 이를 음성인식 API와 통신하여 음성 데이터를 텍스트로 변환해줍니다.

또한, 간편한 설치와 함께 Google, Azure, OpenAI 등 다양한 STT API 서버를 지원합니다. 이 중 일부는 별도의 추가 설정 없이 바로 활용하실 수 있습니다.
본 매뉴얼에서는 Google Speech API를 활용하여 실습을 진행합니다. 다만, 기본 제공되는 무료 사용량은 한정되어 있으므로, 한도를 초과하면 기능 사용이 제한됩니다.

## SpeechRecognition 설치 
다음 명령을 이용해 필수 패키지를 설치합니다.

```sh
> pip install PyAudio
> pip install SpeechRecognition==3.9.0
```

## 첫번째 음성 인식 
다음 예제는 SpeechRecognition 라이브러리를 이용하여 간단히 음성인식을 수행하는 코드입니다. 정상적으로 음성이 인식되면 인식된 음성과 변환된 텍스트가 출력되며, 오류가 발생하면 해당 에러 메시지가 표시됩니다.

```python
import speech_recognition as sr

recognizer = sr.Recognizer()

with sr.Microphone() as source:
    print("Please speech...")
    audio = recognizer.listen(source)

try:
    print("Recognized text: " + recognizer.recognize_google(audio, language='en-US'))
except sr.UnknownValueError:
    print("Google Web Speech API can't understand your speech")
except sr.RequestError as e:
    print(f"Google Web Speech API has something error : {e}")
```

## 음성 인식 후 키워드 추출하기
이번 단계에서는 인식된 텍스트로부터 특정 키워드를 추출하는 예제를 실습합니다.
이전 코드와 동일하게 음성을 인식한 뒤, 변환된 텍스트를 text_parsing 함수에 전달하면 해당 함수는 텍스트 내 특정 키워드를 탐색하여 결과를 반환합니다.

만약 'forward', 'backward', 'stop' 키워드 중 하나가 포함되어 있으면 해당 문자열을 반환하며, 키워드가 없을 경우 None을 반환합니다.

```python
import speech_recognition as sr

def text_parsing(text):
    text = text.strip()

    if 'forward' in text:
        return 'forward'
    elif 'backward' in text:
        return 'backward'
    elif 'stop' in text:
        return 'stop'
    else:
        return None

recognizer = sr.Recognizer()

with sr.Microphone() as source:
    print("Please speech...")
    audio = recognizer.listen(source)

try:
    text = recognizer.recognize_google(audio, language='en-US')
    print("Recognized text : " + text)
    print("Parsing text : " + str(text_parsing(text)))
except sr.UnknownValueError:
    print("Google Web Speech API can't understand your speech")
except sr.RequestError as e:
    print(f"Google Web Speech API has something error : {e}")
```

## 음성 인식을 통한 장치 제어
이제 음성 인식 결과를 단순히 출력하는 수준을 넘어서, PC에서 인식한 음성 → 텍스트 → 키워드 → 시리얼(UART) 전송 → 아두이노에서 RGB LED 제어 까지 연동해보겠습니다.

전체 흐름은 다음과 같습니다.
1. PC에서 마이크 입력을 통해 음성을 받습니다.
2. SpeechRecognition + Google STT를 이용해 텍스트로 변환합니다.
3. 변환된 텍스트에서 색상 키워드를 추출합니다. (예: "red", "blue" 등)
4. 색상 키워드를 시리얼(UART)을 통해 아두이노 보드로 전송합니다.
5. 아두이노는 수신한 문자열을 분석하여 RGB LED 색상을 변경합니다.

### 하드웨어 연결 
PWM 핀을 사용하므로 Red/Green/Blue 핀은 반드시 PWM 핀이어야 합니다.

| Pin | 연결 대상 | 설명 |
|:---:|:---:|:---|
| GND | GND | 접지 |
| 4 | R | Red |
| 5 | G | Green LED |
| 6 | B | Blue |

### 아두이노 프로그램 
아두이노는 PC로부터 "RED", "GREEN", "BLUE" 등 문자열을 시리얼로 수신한 뒤, 해당 명령에 맞게 RGB LED의 색상을 변경합니다.
```cpp
const int PIN_RED   = 4;
const int PIN_GREEN = 5;
const int PIN_BLUE  = 6;

void setColor(bool r, bool g, bool b) {
  digitalWrite(PIN_RED,   r ? HIGH : LOW);
  digitalWrite(PIN_GREEN, g ? HIGH : LOW);
  digitalWrite(PIN_BLUE,  b ? HIGH : LOW);
}

void setup() {
  Serial.begin(115200);

  pinMode(PIN_RED,   OUTPUT);
  pinMode(PIN_GREEN, OUTPUT);
  pinMode(PIN_BLUE,  OUTPUT);
  setColor(false, false, false);

  Serial.println("RGB Voice Control Ready");
  Serial.println("Commands: RED, GREEN, BLUE, YELLOW, PURPLE, BLACK");
}

void loop() {
  if (Serial.available()) {
    String cmd = Serial.readStringUntil('\n');
    cmd.trim();
    cmd.toUpperCase();

    Serial.print("Received command: ");
    Serial.println(cmd);

    if (cmd == "RED") {
      setColor(true, false, false);
    } else if (cmd == "GREEN") {
      setColor(false, true, false);
    } else if (cmd == "BLUE") {
      setColor(false, false, true);
    } else if (cmd == "YELLOW") {
      setColor(true, true, false); 
    } else if (cmd == "PURPLE") {
      setColor(true, false, true);
    } else if (cmd == "BLACK") {
      setColor(false, false, false);
    } else {
      Serial.println("Unknown command");
    }
  }
}
```

### PC 프로그램 
PC에서는 마이크를 통해 음성을 입력받고, 색상 키워드를 인식한 후 해당 색상 문자열을 시리얼 포트를 통해 아두이노로 전송합니다.

```python
import speech_recognition as sr
import serial
import time

SERIAL_PORT = "COM10"
BAUDRATE = 115200

def text_parsing(text: str):
    text = text.strip().lower()
    print(f"[DEBUG] raw text = '{text}'")

    if 'red' in text:
        return 'RED'
    elif 'blue' in text:
        return 'BLUE'
    elif 'green' in text:
        return 'GREEN'
    elif 'yellow' in text:
        return 'YELLOW'
    elif 'purple' in text or 'violet' in text:
        return 'PURPLE'
    elif 'black' in text:
        return 'BLACK'
    else:
        return None

def main():
    try:
        ser = serial.Serial(SERIAL_PORT, BAUDRATE, timeout=1)
        time.sleep(2)
        print(f"[INFO] Serial opened on {SERIAL_PORT} @ {BAUDRATE}bps")
    except Exception as e:
        print(f"[ERROR] Cannot open serial port: {e}")
        return

    recognizer = sr.Recognizer()
    while True:
        with sr.Microphone() as source:
            print("Say a color (red, blue, green, yellow, purple, black)...")
            audio = recognizer.listen(source)
        try:
            text = recognizer.recognize_google(audio, language='en-US')
            print("Recognized text :", text)

            cmd = text_parsing(text)
            print("Parsed command  :", cmd)

            if cmd is not None:
                ser.write((cmd + "\n").encode('utf-8'))
                print(f"[INFO] Sent to Arduino: {cmd}")
            else:
                print("[WARN] No valid color detected in your speech.")

        except sr.UnknownValueError:
            print("Google Web Speech API can't understand your speech")
        except sr.RequestError as e:
            print(f"Google Web Speech API error: {e}")
        except KeyboardInterrupt:
            print("\n[INFO] Exit by user")
            break

    ser.close()
    print("[INFO] Serial closed")

if __name__ == "__main__":
    main()
```