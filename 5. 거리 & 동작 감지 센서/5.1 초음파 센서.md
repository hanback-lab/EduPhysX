# 초음파 센서
## 초음파 센서
초음파 센서는 40 kHz 대역의 초음파를 공기 중으로 발사(Trigger)한 뒤, 물체에 반사되어 돌아오는 시간을 측정하여 물체까지의 거리를 계산하는 센서입니다.
기본 원리는 다음과 같습니다.

- Trigger 핀에 짧은 펄스(10 μs)를 인가하면 송신부가 초음파를 발사합니다.
- 발사된 초음파가 물체에 부딪혀 반사되어 돌아오면 수신부가 이를 감지합니다.
- 이때 발생하는 Echo 신호의 High 구간 시간이 초음파가 이동한 왕복 시간에 해당합니다.
- 거리 = (왕복 시간 × 음속) ÷ 2 로 계산합니다.
    - 음속은 대기 중 약 340 m/s (온도·습도에 따라 변동)

즉, 측정된 시간을 거리로 환산하면 손쉽게 물체와의 거리를 얻을 수 있습니다.

장점
- 구조가 단순하고 가격이 저렴합니다.
- 비교적 정밀하게 근거리(2cm ~ 수 m 범위)의 거리를 측정할 수 있습니다.
- 아두이노, 라즈베리파이 등에서 라이브러리 없이도 제어가 가능합니다.

단점
- 초음파가 직진성이 강하기 때문에 각도가 있는 물체나 흡음 재질(천, 스펀지 등)에서는 반사가 약합니다.
- 여러 개를 동시에 사용하면 초음파 간섭(크로스토크)이 발생할 수 있습니다.
- 측정 가능한 최대 거리(약 4~5 m)와 최소 거리(약 2 cm)의 제한이 있습니다.

![Ultrasonic Schematic](res/Ultrasonic%20Schematic.png)

## 초음파 센서 연결 
초음파 센서 하드웨어 연결은 다음과 같습니다. 

| Pin | 연결 대상 | 설명 |
|:---:|:---:|:---|
| 5V | +5V | 전원 |
| GND | GND | 접지 |
| 9 | TRIG | Ultrasonic Trig |
| 8 | ECHO | Ultrasonic Echo |

## 초음파 센서 제어 
초음파 센서를 활용한 거리 측정 예제 입니다. Trigger 와 연결된 GPIO 를 제어하여 초음파를 발생시키고, 초음파가 반사되서 들어오는 시간을 Echo 와 연결된 GPIO 의 신호 변화를 감지하는 코드입니다. pulseIn() 은 GPIO의 입력 변화를 감지하는 함수로 인자로 전달된 신호가 다른 신호로 변화될때 까지의 시간을 반환합니다. 

만약 pulseIn(9,HIGH) 로 코드를 작성했다면, 9번 GPIO의 신호가 HIGH 에서 LOW 로 변화할떄까지 대기했다가 변화한 순간까지의 마이크로초를 반환합니다. 

```arduino
const int PIN_TRIG = 9;
const int PIN_ECHO = 8;

long duration;
float distance;

void setup() {
  Serial.begin(115200);
  pinMode(PIN_TRIG, OUTPUT);
  pinMode(PIN_ECHO, INPUT);
}

void loop() {
  digitalWrite(PIN_TRIG, LOW);
  delayMicroseconds(2);
  digitalWrite(PIN_TRIG, HIGH);
  delayMicroseconds(10);
  digitalWrite(PIN_TRIG, LOW);

  duration = pulseIn(PIN_ECHO, HIGH);
  distance = (duration * 0.034) / 2.0;

  Serial.print("Distance: ");
  Serial.print(distance);
  Serial.println(" cm");

  delay(200);
}
```

## Serial Plotter 활용
Serial Plotter 를 통해 초음파 센서값을 확인하면 다음과 같이 작성할 수 있습니다. 거리 값이외에 zero 를 출력하는 이유는 0cm 기준을 표기하기 위함입니다. 

```arduino
const int PIN_TRIG = 9;
const int PIN_ECHO = 8;

long duration;
float distance;
int zero = 0;

void setup() {
  Serial.begin(115200);
  pinMode(PIN_TRIG, OUTPUT);
  pinMode(PIN_ECHO, INPUT);
}

void loop() {
  digitalWrite(PIN_TRIG, LOW);
  delayMicroseconds(2);
  digitalWrite(PIN_TRIG, HIGH);
  delayMicroseconds(10);
  digitalWrite(PIN_TRIG, LOW);

  duration = pulseIn(PIN_ECHO, HIGH);
  distance = (duration * 0.034) / 2.0;

  Serial.print("Variable_1:");
  Serial.print(distance);
  Serial.print(",");
  Serial.print("Variable_2:");
  Serial.println(zero);
  
  delay(10);
}
```