# MCU Peripherals
## GPIO
GPIO는 General Purpose Input Output의 약자로, 말 그대로 범용으로 사용되는 입출력 포트를 의미합니다. 임베디드 시스템에는 MCU 외에도 다양한 주변장치들이 존재하는데, 이들을 제어하거나 데이터를 주고받기 위해서는 자유롭게 설정할 수 있는 I/O 포트가 필요합니다. GPIO는 입력 또는 출력으로 설정할 수 있으며, 단순한 디지털 신호 제어부터 키 입력, LED 구동, 모듈 연결까지 폭넓게 활용됩니다.

### ATmega2560의 GPIO 특징
- 10개의 8비트 포트와 1개의 6비트 포트로 구성
- 출력 포트는 최대 40mA의 전류를 소모 가능
- 각 핀은 내부 풀업 저항을 개별적으로 활성화 가능
- 모든 핀은 ESD 보호용 다이오드 내장
- 비트 단위 제어가 가능한 Read-Modify-Write 기능 제공
- 각 포트는 3개의 레지스터 보유
    - PORTx : 출력 데이터 레지스터
    - DDRx : 데이터 방향(입/출력) 레지스터
    - PINx : 입력 데이터 레지스터

### GPIO 제어 함수 
- pinMode(pin, mode) : 해당 핀을 입력(INPUT) 또는 출력(OUTPUT)으로 설정
- digitalWrite(pin, value) : 출력 모드 핀에 HIGH 또는 LOW 값 출력
- digitalRead(pin) : 입력 모드 핀에서 현재 값 읽기 (HIGH/LOW 반환)

## ADC
현실 세계의 온도, 빛, 소리와 같은 물리량은 연속적인 아날로그 신호로 존재합니다. 하지만 MCU는 디지털 신호만 처리할 수 있으므로, 아날로그 신호를 디지털 값으로 변환해주는 ADC(Analog to Digital Converter) 가 필요합니다. 센서에서 들어온 전압을 일정한 해상도의 정수 값으로 변환하여 프로그램에서 활용할 수 있습니다.

### ATmega2560의 ADC 특징 
- 해상도 : 10비트(0 ~ 1023)
- 채널 : 16채널(ADC0 ~ ADC15)
- 참조전압(Reference) : 일반적으로 5V, 외부 활용시 AREF 핀 기준 
- 입력 범위 : 0V ~ Vref (Vref는 선택한 참조전압)
- 변환 속도 : 1회 변환 ≈ 13 ADC클럭 → 기본 설정(16MHz/128=125kHz)에서 약 104µs/샘플(≈9.6kS/s)
- 권장 소스 임피던스 : 10kΩ 이하(크면 샘플링 커패시터 충전 지연으로 오차↑)

### ADC 제어 함수 
- analogRead(pin) : 지정한 아날로그 입력 핀(A0 ~ A15)의 전압 값을 0~1023 범위로 반환
- 첫 변환은 부정확할 수 있으므로 더미 읽기를 권장
- 전압 계산 공식 : V = (analogRead(pin)/ 1023) * Vref

## PWM
PWM(Pulse Width Modulation)은 디지털 신호의 듀티사이클을 조절하여 아날로그 출력처럼 사용하는 기법입니다. 전압을 연속적으로 출력할 수 없는 MCU가 빠른 ON/OFF 신호를 평균화하여 LED 밝기, 모터 속도, 오디오 신호 등 다양한 아날로그 제어에 활용합니다.

### ATmega2560의 PWM 특징 
- 16비트 타이머 2개를 이용해 PWM 발생
- 총 15개의 하드웨어 PWM 출력 핀 제공
- 분해능(Resolution) : 기본 8비트(0~255), 일부 타이머는 16비트까지 지원
- 주파수(Frequency) : 기본적으로 수백 Hz ~ 수 kHz, 사용 타이머에 따라 변경 가능

### PWM 제어 함수 
- analogWrite(pin, value) : 지정한 핀에서 PWM 신호를 출력하는 함수.
    - pin : PWM 출력이 가능한 핀 (예: 3, 5, 6, 9, 10, 11 등)
    - value : 듀티사이클을 0~255 범위의 값으로 지정 (0=0%, 255=100%)
    - 내부적으로 타이머에 연결된 하드웨어 PWM을 이용하며, 핀마다 기본 주파수는 다를 수 있음.

## UART
UART(Universal Asynchronous Receiver/Transmitter)는 MCU와 외부 장치 간의 직렬 비동기 통신 방식을 의미합니다. 송신(TX)과 수신(RX) 두 개의 선만 있으면 통신할 수 있어 가장 단순하면서도 널리 사용됩니다.

- 전송 방식 : 비동기 (클럭 신호 없음)
- 데이터 단위 : 1 Start bit + (5~9 Data bit) + Optional Parity + 1 Stop bit
- 보드레이트(Baud rate) : 초당 전송 비트 속도 (예: 9600bps, 115200bps)
- ATmega2560 : 하드웨어 UART 4개(Serial0~Serial3) 지원
- 주요 활용 : PC와 시리얼 모니터 연결, GPS 모듈, 블루투스 모듈, 시리얼 센서 등

### UART 제어 함수 
- Serial.begin(baudrate) : 통신 속도(baud rate) 지정하여 UART 초기화
- Serial.print(data) : 데이터를 문자열로 전송
- Serial.println(data) : 데이터를 전송 후 줄바꿈(\r\n) 포함
- Serial.read() : 수신 버퍼에서 1바이트 읽기 (없으면 -1 반환)
- Serial.available() : 수신 버퍼에 읽을 수 있는 데이터의 바이트 수 반환

## I2C
I²C(Inter-Integrated Circuit)는 양방향 직렬 버스 방식의 통신 규격입니다. 두 가닥의 신호선만 사용하며, 하나의 마스터가 여러 개의 슬레이브와 통신할 수 있어 센서 연결에 많이 활용됩니다.

- 사용 핀 :
    - SDA (Serial Data) : 데이터 전송
    - SCL (Serial Clock) : 클록 전송
    - Arduino Mega2560 → SDA(20), SCL(21)
- 전송 방식 : 마스터(클록 제공) ↔ 슬레이브(응답) 구조
- 각 슬레이브는 **고유 주소(7비트 or 10비트)**를 가짐
- 속도 : Standard(100kHz), Fast(400kHz), 일부는 1MHz까지 지원

### I2C 제어 함수 
- Wire.begin() : 마스터 모드 초기화 (슬레이브 모드에서는 주소를 인자로 넣음)
- Wire.beginTransmission(addr) : 지정된 슬레이브 주소로 전송 시작
- Wire.write(data) : 데이터 전송
- Wire.endTransmission() : 전송 종료
- Wire.requestFrom(addr, n) : 지정된 슬레이브로부터 n바이트 읽기 요청
- Wire.read() : 수신 버퍼에서 데이터 읽기

## SPI
SPI(Serial Peripheral Interface)는 동기식 직렬 통신 방식으로, I²C보다 빠른 속도를 지원하며 주로 고속 센서, 메모리, 디스플레이 모듈 등에 활용됩니다.

### ATmega2560의 SPI 특징
- 핀 배치 (하드웨어 고정)
    - MOSI : 51
    - MISO : 50
    - SCK : 52
    - SS : 53
- 통신 방식 : 마스터와 슬레이브 간 풀 듀플렉스
- 속도 : 수 MHz 단위 (I²C보다 빠름)
- 다중 슬레이브 연결 가능 (각 슬레이브마다 SS 핀 별도 필요)

### SPI 제어 함수 
- SPI.begin() : SPI 초기화
- SPI.beginTransaction(SPISettings(speed, order, mode)) : 통신 속도·비트 순서·모드 설정
- SPI.transfer(data) : 1바이트 데이터 송수신
- SPI.endTransaction() : 현재 전송 종료
- SPI.end() : SPI 비활성화